<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disaster Response Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #4A5568;
            margin-bottom: 10px;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1rem;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #48BB78;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
        }

        .content-panel {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .content-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4A5568;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #E2E8F0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #718096;
            margin-left: 10px;
        }

        .btn-danger {
            background: #E53E3E;
        }

        .results {
            margin-top: 30px;
        }

        .result-item {
            background: #F7FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .result-item:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .result-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .result-title {
            font-weight: 600;
            color: #2D3748;
            margin-bottom: 5px;
        }

        .result-meta {
            color: #718096;
            font-size: 12px;
        }

        .tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin: 2px;
            font-weight: 500;
        }

        .urgent {
            background: #E53E3E;
            animation: pulse 1s infinite;
        }

        .verified {
            background: #48BB78;
        }

        .rejected {
            background: #E53E3E;
        }

        .pending {
            background: #ED8936;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48BB78;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #E53E3E;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .realtime-updates {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 300px;
            backdrop-filter: blur(10px);
        }

        .update-item {
            padding: 8px 0;
            border-bottom: 1px solid #E2E8F0;
            font-size: 12px;
        }

        .update-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                margin-bottom: 5px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö® Disaster Response Platform</h1>
            <p class="subtitle">Real-time disaster management and resource coordination</p>
        </div>

        <div class="status-bar">
            <div class="user-info">
                <div class="status-indicator"></div>
                <span>Connected as: <strong id="current-user">netrunnerX</strong></span>
            </div>
            <div>
                <span id="connection-status">üü¢ Online</span>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('disasters')">üèòÔ∏è Disasters</div>
            <div class="tab" onclick="showTab('resources')">üì¶ Resources</div>
            <div class="tab" onclick="showTab('social-media')">üì± Social Media</div>
            <div class="tab" onclick="showTab('verification')">‚úÖ Verification</div>
            <div class="tab" onclick="showTab('geocoding')">üó∫Ô∏è Geocoding</div>
        </div>

        <!-- Disasters Panel -->
        <div id="disasters" class="content-panel active">
            <h2>Disaster Management</h2>
            
            <div class="form-group">
                <label>Create New Disaster</label>
                <div class="grid">
                    <div>
                        <input type="text" id="disaster-title" placeholder="Disaster title">
                    </div>
                    <div>
                        <input type="text" id="disaster-location" placeholder="Location (e.g., Manhattan, NYC)">
                    </div>
                </div>
                <textarea id="disaster-description" placeholder="Detailed description of the disaster..."></textarea>
                <select id="disaster-tags" multiple>
                    <option value="flood">Flood</option>
                    <option value="earthquake">Earthquake</option>
                    <option value="fire">Fire</option>
                    <option value="hurricane">Hurricane</option>
                    <option value="tornado">Tornado</option>
                    <option value="other">Other</option>
                </select>
                <button class="btn" onclick="createDisaster()">Create Disaster</button>
            </div>

            <div class="form-group">
                <label>Filter Disasters</label>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <select id="filter-tag">
                        <option value="">All Tags</option>
                        <option value="flood">Flood</option>
                        <option value="earthquake">Earthquake</option>
                        <option value="fire">Fire</option>
                        <option value="hurricane">Hurricane</option>
                        <option value="tornado">Tornado</option>
                    </select>
                    <button class="btn" onclick="loadDisasters()">Refresh</button>
                </div>
            </div>

            <div class="results" id="disasters-list">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading disasters...
                </div>
            </div>
        </div>

        <!-- Resources Panel -->
        <div id="resources" class="content-panel">
            <h2>Resource Management</h2>
            
            <div class="form-group">
                <label>Add New Resource</label>
                <div class="grid">
                    <div>
                        <input type="text" id="resource-name" placeholder="Resource name">
                    </div>
                    <div>
                        <select id="resource-type">
                            <option value="shelter">Shelter</option>
                            <option value="food">Food</option>
                            <option value="water">Water</option>
                            <option value="medical">Medical</option>
                            <option value="rescue">Rescue</option>
                            <option value="transport">Transport</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <input type="text" id="resource-location" placeholder="Location">
                <textarea id="resource-description" placeholder="Description and contact information..."></textarea>
                <button class="btn" onclick="createResource()">Add Resource</button>
            </div>

            <div class="form-group">
                <label>Find Nearby Resources</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="search-coords" placeholder="Lat,Lng (e.g., 40.7128,-74.0060)">
                    <input type="number" id="search-radius" placeholder="Radius (km)" value="10">
                    <button class="btn" onclick="searchNearbyResources()">Search</button>
                </div>
            </div>

            <div class="results" id="resources-list">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading resources...
                </div>
            </div>
        </div>

        <!-- Social Media Panel -->
        <div id="social-media" class="content-panel">
            <h2>Social Media Monitoring</h2>
            
            <div class="form-group">
                <label>Monitor Disaster</label>
                <div style="display: flex; gap: 10px;">
                    <select id="social-disaster-select">
                        <option value="">Select a disaster...</option>
                    </select>
                    <button class="btn" onclick="fetchSocialMediaReports()">Fetch Reports</button>
                </div>
            </div>

            <div class="form-group">
                <label>Analyze Social Media Post</label>
                <textarea id="analyze-post-content" placeholder="Enter social media post content..."></textarea>
                <button class="btn" onclick="analyzeSocialPost()">Analyze Post</button>
            </div>

            <div class="results" id="social-media-results">
                <p>Select a disaster to monitor social media reports.</p>
            </div>
        </div>

        <!-- Verification Panel -->
        <div id="verification" class="content-panel">
            <h2>Image Verification</h2>
            
            <div class="form-group">
                <label>Verify Image</label>
                <input type="url" id="verify-image-url" placeholder="Image URL">
                <textarea id="verify-context" placeholder="Context or description..."></textarea>
                <button class="btn" onclick="verifyImage()">Verify Image</button>
            </div>

            <div class="results" id="verification-results">
                <p>Enter an image URL to verify its authenticity.</p>
            </div>
        </div>

        <!-- Geocoding Panel -->
        <div id="geocoding" class="content-panel">
            <h2>Location Services</h2>
            
            <div class="form-group">
                <label>Geocode Location</label>
                <input type="text" id="geocode-location" placeholder="Location name (e.g., Manhattan, NYC)">
                <button class="btn" onclick="geocodeLocation()">Geocode</button>
            </div>

            <div class="form-group">
                <label>Extract Locations from Text</label>
                <textarea id="extract-text" placeholder="Enter text containing location mentions..."></textarea>
                <button class="btn" onclick="extractLocations()">Extract Locations</button>
            </div>

            <div class="results" id="geocoding-results">
                <p>Enter a location name or text to process.</p>
            </div>
        </div>
    </div>

    <!-- Real-time Updates -->
    <div class="realtime-updates" id="realtime-updates">
        <h4>üì° Real-time Updates</h4>
        <div id="updates-list">
            <div class="update-item">System initialized</div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Configuration
        const API_BASE = 'http://localhost:5000/api';
        const currentUser = 'netrunnerX'; // Default user for testing
        
        // Initialize Socket.IO
        const socket = io(
            'ws://localhost:5000',
            {
                transports: ['websocket'],
                query: { user_id: currentUser }
            }
        );
        
        // State management
        let disasters = [];
        let resources = [];
        
        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Add real-time update
        function addRealtimeUpdate(message) {
            const updatesList = document.getElementById('updates-list');
            const updateItem = document.createElement('div');
            updateItem.className = 'update-item';
            updateItem.innerHTML = `<small>${new Date().toLocaleTimeString()}</small><br>${message}`;
            updatesList.insertBefore(updateItem, updatesList.firstChild);
            
            // Keep only last 5 updates
            while (updatesList.children.length > 5) {
                updatesList.removeChild(updatesList.lastChild);
            }
        }

        // API request helper
        async function apiRequest(endpoint, options = {}) {
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    'x-user-id': currentUser
                },
                ...options
            };
            
            if (config.body && typeof config.body === 'object') {
                config.body = JSON.stringify(config.body);
            }
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, config);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API request failed:', error);
                showNotification(`API Error: ${error.message}`, 'error');
                throw error;
            }
        }

        // Tab management
        function showTab(tabName) {
            // Hide all panels
            document.querySelectorAll('.content-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected panel and activate tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data for the selected tab
            switch(tabName) {
                case 'disasters':
                    loadDisasters();
                    break;
                case 'resources':
                    loadResources();
                    break;
            }
        }

        // Disaster functions
        async function createDisaster() {
            const title = document.getElementById('disaster-title').value;
            const location = document.getElementById('disaster-location').value;
            const description = document.getElementById('disaster-description').value;
            const tags = Array.from(document.getElementById('disaster-tags').selectedOptions).map(opt => opt.value);
            
            if (!title || !location || !description || tags.length === 0) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            try {
                const result = await apiRequest('/disasters', {
                    method: 'POST',
                    body: {
                        title,
                        location_name: location,
                        description,
                        tags
                    }
                });
                
                showNotification('Disaster created successfully!');
                
                // Clear form
                document.getElementById('disaster-title').value = '';
                document.getElementById('disaster-location').value = '';
                document.getElementById('disaster-description').value = '';
                document.getElementById('disaster-tags').selectedIndex = -1;
                
                // Reload disasters
                loadDisasters();
                
            } catch (error) {
                console.error('Failed to create disaster:', error);
            }
        }

        async function loadDisasters() {
            const filterTag = document.getElementById('filter-tag').value;
            const resultsList = document.getElementById('disasters-list');
            
            resultsList.innerHTML = '<div class="loading"><div class="spinner"></div>Loading disasters...</div>';
            
            try {
                const params = new URLSearchParams();
                if (filterTag) params.append('tag', filterTag);
                
                const result = await apiRequest(`/disasters?${params}`);

                console.log('Disasters loaded:', result);
                disasters = result.data;
                
                if (disasters.length === 0) {
                    resultsList.innerHTML = '<p>No disasters found. Create one above to get started.</p>';
                    return;
                }
                
                resultsList.innerHTML = disasters.map(disaster => `
                    <div class="result-item">
                        <div class="result-header">
                            <div class="result-title">${disaster.title}</div>
                            <div class="result-meta">
                                Priority: ${disaster.priority_level || 1} | 
                                Created: ${new Date(disaster.created_at).toLocaleDateString()}
                            </div>
                        </div>
                        <p><strong>Location:</strong> ${disaster.location_name}</p>
                        <p><strong>Description:</strong> ${disaster.description}</p>
                        <div style="margin-top: 10px;">
                            ${disaster.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn" onclick="monitorSocialMedia('${disaster.id}')">Monitor Social Media</button>
                            <button class="btn btn-secondary" onclick="findNearbyResources('${disaster.id}')">Find Resources</button>
                        </div>
                    </div>
                `).join('');
                
                // Populate disaster select for social media
                const socialSelect = document.getElementById('social-disaster-select');
                socialSelect.innerHTML = '<option value="">Select a disaster...</option>' + 
                    disasters.map(d => `<option value="${d.id}">${d.title}</option>`).join('');
                
            } catch (error) {
                resultsList.innerHTML = '<p>Failed to load disasters. Please try again.</p>';
            }
        }

        // Resource functions
        async function createResource() {
            const name = document.getElementById('resource-name').value;
            const type = document.getElementById('resource-type').value;
            const location = document.getElementById('resource-location').value;
            const description = document.getElementById('resource-description').value;
            
            if (!name || !type || !location) {
                showNotification('Please fill in required fields', 'error');
                return;
            }
            
            try {
                const result = await apiRequest('/resources', {
                    method: 'POST',
                    body: {
                        name,
                        type,
                        location_name: location,
                        description
                    }
                });
                
                showNotification('Resource added successfully!');
                
                // Clear form
                document.getElementById('resource-name').value = '';
                document.getElementById('resource-location').value = '';
                document.getElementById('resource-description').value = '';
                
                // Reload resources
                loadResources();
                
            } catch (error) {
                console.error('Failed to create resource:', error);
            }
        }

        async function loadResources() {
            const resultsList = document.getElementById('resources-list');
            
            resultsList.innerHTML = '<div class="loading"><div class="spinner"></div>Loading resources...</div>';
            
            try {
                const result = await apiRequest('/resources');
                resources = result.data;
                
                if (resources.length === 0) {
                    resultsList.innerHTML = '<p>No resources found. Add one above to get started.</p>';
                    return;
                }
                
                resultsList.innerHTML = resources.map(resource => `
                    <div class="result-item">
                        <div class="result-header">
                            <div class="result-title">${resource.name}</div>
                            <div class="result-meta">
                                Type: ${resource.type} | 
                                Available: ${resource.is_available ? '‚úÖ' : '‚ùå'}
                            </div>
                        </div>
                        <p><strong>Location:</strong> ${resource.location_name}</p>
                        ${resource.description ? `<p><strong>Description:</strong> ${resource.description}</p>` : ''}
                        ${resource.capacity ? `<p><strong>Capacity:</strong> ${resource.capacity}</p>` : ''}
                        <span class="tag">${resource.type}</span>
                    </div>
                `).join('');
                
            } catch (error) {
                resultsList.innerHTML = '<p>Failed to load resources. Please try again.</p>';
            }
        }

        async function searchNearbyResources() {
            const coords = document.getElementById('search-coords').value;
            const radius = document.getElementById('search-radius').value;
            
            if (!coords) {
                showNotification('Please enter coordinates', 'error');
                return;
            }
            
            const [lat, lng] = coords.split(',').map(s => parseFloat(s.trim()));
            
            if (isNaN(lat) || isNaN(lng)) {
                showNotification('Invalid coordinates format', 'error');
                return;
            }
            
            try {
                const result = await apiRequest('/resources/search/nearby', {
                    method: 'POST',
                    body: {
                        lat,
                        lng,
                        distance_km: parseFloat(radius),
                        limit: 20
                    }
                });
                
                const resultsList = document.getElementById('resources-list');
                const nearbyResources = result.data.resources;
                
                if (nearbyResources.length === 0) {
                    resultsList.innerHTML = '<p>No resources found within the specified radius.</p>';
                    return;
                }
                
                resultsList.innerHTML = `
                    <h3>Found ${nearbyResources.length} resources within ${radius}km</h3>
                    ${nearbyResources.map(resource => `
                        <div class="result-item">
                            <div class="result-header">
                                <div class="result-title">${resource.name}</div>
                                <div class="result-meta">
                                    Distance: ${(resource.distance_meters / 1000).toFixed(1)}km | 
                                    Type: ${resource.type}
                                </div>
                            </div>
                            <p><strong>Location:</strong> ${resource.location_name}</p>
                            ${resource.description ? `<p>${resource.description}</p>` : ''}
                            <span class="tag">${resource.type}</span>
                        </div>
                    `).join('')}
                `;
                
                showNotification(`Found ${nearbyResources.length} nearby resources`);
                
            } catch (error) {
                console.error('Failed to search resources:', error);
            }
        }

        // Social Media functions
        async function fetchSocialMediaReports() {
            const disasterId = document.getElementById('social-disaster-select').value;
            
            if (!disasterId) {
                showNotification('Please select a disaster', 'error');
                return;
            }
            
            const resultsDiv = document.getElementById('social-media-results');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Fetching social media reports...</div>';
            
            try {
                const result = await apiRequest(`/social-media/disasters/${disasterId}/reports`);
                const posts = result.data.posts;
                
                if (posts.length === 0) {
                    resultsDiv.innerHTML = '<p>No social media reports found for this disaster.</p>';
                    return;
                }
                
                resultsDiv.innerHTML = `
                    <h3>Found ${posts.length} social media reports</h3>
                    <p><strong>Urgent posts:</strong> ${result.data.metadata.urgent_posts}</p>
                    ${posts.map(post => `
                        <div class="result-item">
                            <div class="result-header">
                                <div class="result-title">@${post.author}</div>
                                <div class="result-meta">
                                    ${post.platform} | ${new Date(post.createdAt).toLocaleString()}
                                    ${post.isUrgent ? '<span class="tag urgent">URGENT</span>' : ''}
                                </div>
                            </div>
                            <p>${post.content}</p>
                            <div style="margin-top: 10px;">
                                <span class="tag">${post.classification}</span>
                                ${post.keywords.map(keyword => `<span class="tag">${keyword}</span>`).join('')}
                            </div>
                            ${post.metrics ? `
                                <div class="result-meta" style="margin-top: 10px;">
                                    üëç ${post.metrics.likes} | üîÑ ${post.metrics.retweets} | üí¨ ${post.metrics.replies}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                `;
                
                showNotification(`Fetched ${posts.length} social media reports`);
                
            } catch (error) {
                resultsDiv.innerHTML = '<p>Failed to fetch social media reports. Please try again.</p>';
            }
        }

        async function analyzeSocialPost() {
            const content = document.getElementById('analyze-post-content').value;
            
            if (!content.trim()) {
                showNotification('Please enter post content to analyze', 'error');
                return;
            }
            
            try {
                const result = await apiRequest('/social-media/analyze-post', {
                    method: 'POST',
                    body: { content }
                });
                
                const analysis = result.data.analysis;
                const resultsDiv = document.getElementById('social-media-results');
                
                resultsDiv.innerHTML = `
                    <h3>Social Media Post Analysis</h3>
                    <div class="result-item">
                        <div class="result-title">Analysis Results</div>
                        <p><strong>Relevance Score:</strong> ${(analysis.relevance.score * 100).toFixed(1)}%</p>
                        <p><strong>Classification:</strong> ${analysis.relevance.classification}</p>
                        <p><strong>Is Urgent:</strong> ${analysis.relevance.is_urgent ? '‚ö†Ô∏è YES' : '‚úÖ No'}</p>
                        <div style="margin: 15px 0;">
                            <strong>Keywords Found:</strong><br>
                            ${analysis.relevance.keywords_found.map(keyword => `<span class="tag">${keyword}</span>`).join('')}
                        </div>
                        <div style="margin: 15px 0;">
                            <strong>Disaster Indicators:</strong><br>
                            ${analysis.disaster_indicators.contains_help_request ? '<span class="tag">Help Request</span>' : ''}
                            ${analysis.disaster_indicators.contains_disaster_keywords ? '<span class="tag">Disaster Keywords</span>' : ''}
                            ${analysis.disaster_indicators.urgency_indicators ? '<span class="tag urgent">Urgent</span>' : ''}
                        </div>
                        <div style="margin: 15px 0;">
                            <strong>Recommendations:</strong>
                            <ul style="margin-top: 10px;">
                                ${analysis.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
                
                showNotification('Post analysis completed');
                
            } catch (error) {
                console.error('Failed to analyze post:', error);
            }
        }

        // Verification functions
        async function verifyImage() {
            const imageUrl = document.getElementById('verify-image-url').value;
            const context = document.getElementById('verify-context').value;
            
            if (!imageUrl) {
                showNotification('Please enter an image URL', 'error');
                return;
            }
            
            const resultsDiv = document.getElementById('verification-results');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Verifying image...</div>';
            
            try {
                const result = await apiRequest('/verification/verify-image', {
                    method: 'POST',
                    body: {
                        image_url: imageUrl,
                        context: context
                    }
                });
                
                const verification = result.data.verification;
                
                resultsDiv.innerHTML = `
                    <h3>Image Verification Results</h3>
                    <div class="result-item">
                        <div class="result-header">
                            <div class="result-title">
                                ${verification.isAuthentic ? '‚úÖ Authentic' : '‚ùå Not Authentic'}
                            </div>
                            <div class="result-meta">
                                Confidence: ${verification.confidence}%
                            </div>
                        </div>
                        <p><strong>Image URL:</strong> <a href="${imageUrl}" target="_blank">${imageUrl}</a></p>
                        <p><strong>Reasoning:</strong> ${verification.reasoning}</p>
                        <p><strong>Context Match:</strong> ${verification.contextMatch ? '‚úÖ Yes' : '‚ùå No'}</p>
                        ${verification.redFlags.length > 0 ? `
                            <div style="margin: 15px 0;">
                                <strong>‚ö†Ô∏è Red Flags:</strong><br>
                                ${verification.redFlags.map(flag => `<span class="tag rejected">${flag}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div style="margin: 15px 0;">
                            <strong>Recommendations:</strong><br>
                            ${verification.recommendations}
                        </div>
                    </div>
                `;
                
                showNotification(`Image verification completed - ${verification.isAuthentic ? 'Authentic' : 'Not Authentic'}`);
                
            } catch (error) {
                resultsDiv.innerHTML = '<p>Failed to verify image. Please try again.</p>';
            }
        }

        // Geocoding functions
        async function geocodeLocation() {
            const locationName = document.getElementById('geocode-location').value;
            
            if (!locationName.trim()) {
                showNotification('Please enter a location name', 'error');
                return;
            }
            
            const resultsDiv = document.getElementById('geocoding-results');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Geocoding location...</div>';
            
            try {
                const result = await apiRequest('/geocoding/geocode', {
                    method: 'POST',
                    body: {
                        location_name: locationName
                    }
                });
                
                const data = result.data;
                
                resultsDiv.innerHTML = `
                    <h3>Geocoding Results</h3>
                    <div class="result-item">
                        <div class="result-title">Location: ${data.input.location_name}</div>
                        <div class="result-meta">Provider: ${data.provider}</div>
                        ${data.primary_result ? `
                            <p><strong>Coordinates:</strong> ${data.primary_result.lat}, ${data.primary_result.lng}</p>
                            <p><strong>Formatted Address:</strong> ${data.primary_result.formattedAddress}</p>
                            <p><strong>Confidence:</strong> ${(data.primary_result.confidence * 100).toFixed(1)}%</p>
                            <span class="tag verified">Geocoded Successfully</span>
                        ` : '<p>‚ùå Geocoding failed</p>'}
                    </div>
                `;
                
                showNotification('Location geocoded successfully');
                
            } catch (error) {
                resultsDiv.innerHTML = '<p>Failed to geocode location. Please try again.</p>';
            }
        }

        async function extractLocations() {
            const text = document.getElementById('extract-text').value;
            
            if (!text.trim()) {
                showNotification('Please enter text to analyze', 'error');
                return;
            }
            
            const resultsDiv = document.getElementById('geocoding-results');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Extracting locations...</div>';
            
            try {
                const result = await apiRequest('/geocoding/extract-locations', {
                    method: 'POST',
                    body: {
                        description: text,
                        auto_geocode: true
                    }
                });
                
                const data = result.data;
                
                resultsDiv.innerHTML = `
                    <h3>Location Extraction Results</h3>
                    <p><strong>Found ${data.extracted_locations.length} locations</strong></p>
                    ${data.extracted_locations.length > 0 ? `
                        <div class="grid">
                            ${data.extracted_locations.map((location, index) => {
                                const geocoded = data.geocoded_locations[index];
                                return `
                                    <div class="card">
                                        <div class="result-title">${location}</div>
                                        ${geocoded && geocoded.geocoding_success ? `
                                            <p><strong>Coordinates:</strong> ${geocoded.coordinates.lat}, ${geocoded.coordinates.lng}</p>
                                            <p><strong>Address:</strong> ${geocoded.coordinates.formattedAddress}</p>
                                            <span class="tag verified">Geocoded</span>
                                        ` : `
                                            <p>‚ùå Geocoding failed</p>
                                            <span class="tag rejected">Not Geocoded</span>
                                        `}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    ` : '<p>No locations found in the text.</p>'}
                `;
                
                showNotification(`Extracted ${data.extracted_locations.length} locations`);
                
            } catch (error) {
                resultsDiv.innerHTML = '<p>Failed to extract locations. Please try again.</p>';
            }
        }

        // Helper functions for disaster actions
        function monitorSocialMedia(disasterId) {
            document.getElementById('social-disaster-select').value = disasterId;
            showTab('social-media');
            fetchSocialMediaReports();
        }

        function findNearbyResources(disasterId) {
            const disaster = disasters.find(d => d.id === disasterId);
            if (disaster && disaster.location) {
                // Extract coordinates if available
                showTab('resources');
                showNotification(`Finding resources near ${disaster.location_name}`);
            } else {
                showTab('resources');
                showNotification('Location coordinates not available for this disaster', 'error');
            }
        }

        // Socket.IO event handlers
        socket.on('connect', () => {
            document.getElementById('connection-status').innerHTML = 'üü¢ Online';
            addRealtimeUpdate('Connected to real-time updates');
        });

        socket.on('disconnect', () => {
            document.getElementById('connection-status').innerHTML = 'üî¥ Offline';
            addRealtimeUpdate('Disconnected from real-time updates');
        });

        socket.on('disaster_created', (data) => {
            addRealtimeUpdate(`üö® New disaster: ${data.disaster.title} by ${data.user}`);
            if (document.querySelector('#disasters.active')) {
                loadDisasters();
            }
        });

        socket.on('disaster_updated', (data) => {
            addRealtimeUpdate(`üìù Disaster updated: ${data.disaster.title} by ${data.updatedBy}`);
        });

        socket.on('resource_created', (data) => {
            addRealtimeUpdate(`üì¶ New resource: ${data.resource.name} by ${data.user}`);
            if (document.querySelector('#resources.active')) {
                loadResources();
            }
        });

        socket.on('social_media_updated', (data) => {
            addRealtimeUpdate(`üì± ${data.newPosts} new social media posts (${data.urgentPosts} urgent)`);
        });

        socket.on('report_verified', (data) => {
            addRealtimeUpdate(`‚úÖ Report verified: ${data.verificationStatus} by ${data.verifiedBy}`);
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            loadDisasters();
            addRealtimeUpdate('üöÄ Disaster Response Platform initialized');
        });
    </script>
</body>
</html>